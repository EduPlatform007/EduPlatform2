/**
 * –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú –° –¢–ï–°–¢–ê–ú–ò –ò –ü–†–ê–ö–¢–ò–ö–û–ô
 * –ê–≤—Ç–æ—Ä: Cascade AI
 * –î–∞—Ç–∞: 2025-05-20
 */

// –ó–∞–ø—É—Å–∫–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('load', function() {
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...");
    
    // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
    setTimeout(function() {
        fixEverything();
    }, 500);
});

/**
 * –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
 */
function fixEverything() {
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–∞—á–∏–Ω–∞—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º");
    
    // 1. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏
    fixStyles();
    
    // 2. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–æ–≤
    fixTestButtons();
    
    // 3. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π
    fixPracticeButtons();
    
    // 4. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞
    fixCompletionButton();
    
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã");
}

/**
 * –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å—Ç–∏–ª–∏
 */
function fixStyles() {
    // –°–æ–∑–¥–∞–µ–º —Å—Ç–∏–ª–∏
    const style = document.createElement('style');
    style.textContent = `
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∞–π–¥–±–∞—Ä–∞ */
        .sidebar h2, .sidebar .lesson-list, .sidebar .lesson-list li, .sidebar .lesson-item {
            text-align: left !important;
            margin-left: 0 !important;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ */
        .feedback-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-weight: 500;
            display: block;
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        .feedback-message.success {
            background-color: rgba(76, 175, 80, 0.1);
            border: 1px solid #4CAF50;
            color: #2E7D32;
        }
        
        .feedback-message.error {
            background-color: rgba(244, 67, 54, 0.1);
            border: 1px solid #F44336;
            color: #C62828;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π */
        .practice, .practice-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .practice textarea, .practice-section textarea {
            width: 100%;
            min-height: 150px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            font-family: monospace;
            margin-bottom: 15px;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    `;
    
    document.head.appendChild(style);
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°—Ç–∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã");
}

/**
 * –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–æ–≤
 */
function fixTestButtons() {
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–æ–≤
    const testButtons = document.querySelectorAll('button[onclick*="checkQuiz"], button[onclick*="test"]');
    
    if (testButtons.length === 0) {
        // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—â–µ–º –≤ —Å–µ–∫—Ü–∏—è—Ö —Ç–µ—Å—Ç–æ–≤
        const testSections = document.querySelectorAll('.test, .quiz');
        testSections.forEach(section => {
            const button = section.querySelector('button');
            if (button) {
                replaceTestButton(button);
            } else {
                // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
                createTestButton(section);
            }
        });
    } else {
        // –ó–∞–º–µ–Ω—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        testButtons.forEach(button => {
            replaceTestButton(button);
        });
    }
    
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã");
}

/**
 * –ó–∞–º–µ–Ω—è–µ—Ç –∫–Ω–æ–ø–∫—É —Ç–µ—Å—Ç–∞ –Ω–∞ –Ω–æ–≤—É—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º
 */
function replaceTestButton(oldButton) {
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É
    const newButton = document.createElement('button');
    newButton.className = oldButton.className || 'test-check-btn';
    newButton.textContent = getCurrentLanguage() === 'ru' ? '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç' : '–¢–µ—Å—Ç—ñ —Ç–µ–∫—Å–µ—Ä—É';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    newButton.addEventListener('click', function() {
        const testSection = this.closest('.test, .quiz');
        if (testSection) {
            checkTest(testSection);
        }
    });
    
    // –ó–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—É—é –∫–Ω–æ–ø–∫—É –Ω–æ–≤–æ–π
    if (oldButton.parentNode) {
        oldButton.parentNode.replaceChild(newButton, oldButton);
    }
}

/**
 * –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É —Ç–µ—Å—Ç–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å–µ–∫—Ü–∏–∏
 */
function createTestButton(testSection) {
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏
    const buttonContainer = document.createElement('div');
    buttonContainer.className = 'test-actions';
    
    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É
    const button = document.createElement('button');
    button.className = 'test-check-btn';
    button.textContent = getCurrentLanguage() === 'ru' ? '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç' : '–¢–µ—Å—Ç—ñ —Ç–µ–∫—Å–µ—Ä—É';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    button.addEventListener('click', function() {
        checkTest(testSection);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Å–µ–∫—Ü–∏—é
    buttonContainer.appendChild(button);
    testSection.appendChild(buttonContainer);
}

/**
 * –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π
 */
function fixPracticeButtons() {
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π
    const practiceButtons = document.querySelectorAll('button:contains("–∫–æ–¥"), button:contains("code")');
    
    if (practiceButtons.length === 0) {
        // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—â–µ–º –≤ —Å–µ–∫—Ü–∏—è—Ö –ø—Ä–∞–∫—Ç–∏–∫–∏
        const practiceSections = document.querySelectorAll('.practice, .practice-section');
        practiceSections.forEach(section => {
            const button = section.querySelector('button');
            if (button) {
                replacePracticeButton(button);
            } else {
                // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
                createPracticeButton(section);
            }
        });
    } else {
        // –ó–∞–º–µ–Ω—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        practiceButtons.forEach(button => {
            replacePracticeButton(button);
        });
    }
    
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö–Ω–æ–ø–∫–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã");
}

/**
 * –ó–∞–º–µ–Ω—è–µ—Ç –∫–Ω–æ–ø–∫—É –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞ –Ω–æ–≤—É—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º
 */
function replacePracticeButton(oldButton) {
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É
    const newButton = document.createElement('button');
    newButton.className = oldButton.className || 'practice-check-btn';
    newButton.textContent = getCurrentLanguage() === 'ru' ? '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥' : '–ö–æ–¥—Ç—ã —Ç–µ–∫—Å–µ—Ä—É';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    newButton.addEventListener('click', function() {
        const practiceSection = this.closest('.practice, .practice-section');
        if (practiceSection) {
            const textarea = practiceSection.querySelector('textarea');
            if (textarea) {
                checkPractice(textarea, practiceSection);
            }
        }
    });
    
    // –ó–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—É—é –∫–Ω–æ–ø–∫—É –Ω–æ–≤–æ–π
    if (oldButton.parentNode) {
        oldButton.parentNode.replaceChild(newButton, oldButton);
    }
}

/**
 * –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å–µ–∫—Ü–∏–∏
 */
function createPracticeButton(practiceSection) {
    // –ù–∞—Ö–æ–¥–∏–º textarea
    const textarea = practiceSection.querySelector('textarea');
    if (!textarea) return;
    
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏
    const buttonContainer = document.createElement('div');
    buttonContainer.className = 'practice-actions';
    
    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É
    const button = document.createElement('button');
    button.className = 'practice-check-btn';
    button.textContent = getCurrentLanguage() === 'ru' ? '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥' : '–ö–æ–¥—Ç—ã —Ç–µ–∫—Å–µ—Ä—É';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    button.addEventListener('click', function() {
        checkPractice(textarea, practiceSection);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å–ª–µ textarea
    buttonContainer.appendChild(button);
    textarea.parentNode.insertBefore(buttonContainer, textarea.nextSibling);
}

/**
 * –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞
 */
function fixCompletionButton() {
    // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞
    const completeButton = document.querySelector('.complete-btn');
    if (!completeButton) return;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    const originalOnClick = completeButton.getAttribute('onclick');
    
    // –£–¥–∞–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    completeButton.removeAttribute('onclick');
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    completeButton.addEventListener('click', function(e) {
        e.preventDefault();
        
        // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞
        const lessonNum = getLessonNumber();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ª–∏ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è
        const testCompleted = isTestCompleted();
        const practiceCompleted = isPracticeCompleted();
        
        if (testCompleted && practiceCompleted) {
            // –ï—Å–ª–∏ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º —É—Ä–æ–∫
            console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º —É—Ä–æ–∫");
            
            // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞
            if (originalOnClick) {
                eval(originalOnClick);
            } else if (typeof window.completeLesson === 'function') {
                window.completeLesson(lessonNum);
            }
        } else {
            // –ï—Å–ª–∏ –Ω–µ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–µ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã");
            showCompletionMessage(false);
        }
    });
    
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞");
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ—Å—Ç
 */
function checkTest(testSection) {
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
    const questions = testSection.querySelectorAll('.test-question');
    if (questions.length === 0) {
        console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í–æ–ø—Ä–æ—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞
    const lessonNum = getLessonNumber();
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–∞ –¥–ª—è —É—Ä–æ–∫–∞", lessonNum);
    
    // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
    const correctAnswers = getCorrectTestAnswers(lessonNum);
    if (!correctAnswers) {
        console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—Ç–≤–µ—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");
        return;
    }
    
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:", correctAnswers);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç—ã
    let allCorrect = true;
    
    questions.forEach((question, index) => {
        // –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
        const selectedOption = question.querySelector('input[type="radio"]:checked');
        if (!selectedOption) {
            allCorrect = false;
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –≤–æ–ø—Ä–æ—Å–∞ (q1, q2, ...)
        const questionName = selectedOption.getAttribute('name');
        
        // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        const correctAnswer = correctAnswers[questionName];
        if (!correctAnswer) {
            console.log(`üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—Ç–≤–µ—Ç –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ ${questionName} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
        const userAnswer = selectedOption.value;
        const isCorrect = userAnswer === correctAnswer;
        
        console.log(`üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í–æ–ø—Ä–æ—Å ${questionName}: –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userAnswer}, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç ${correctAnswer}, —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${isCorrect ? '–≤–µ—Ä–Ω–æ' : '–Ω–µ–≤–µ—Ä–Ω–æ'}`);
        
        if (!isCorrect) {
            allCorrect = false;
        }
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    showTestResult(testSection, allCorrect);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    saveTestResult(lessonNum, allCorrect);
    
    console.log(`üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ—Å—Ç–∞: ${allCorrect ? '–≤–µ—Ä–Ω–æ' : '–Ω–µ–≤–µ—Ä–Ω–æ'}`);
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
 */
function checkPractice(textarea, practiceSection) {
    // –ü–æ–ª—É—á–∞–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã–π –∫–æ–¥
    const userCode = textarea.value.trim();
    if (!userCode) {
        console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö–æ–¥ –Ω–µ –≤–≤–µ–¥–µ–Ω");
        showPracticeResult(practiceSection, false);
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞
    const lessonNum = getLessonNumber();
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è —É—Ä–æ–∫–∞", lessonNum);
    
    // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥
    const correctCode = getCorrectPracticeCode(lessonNum);
    if (!correctCode) {
        console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω");
        return;
    }
    
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥:", correctCode);
    console.log("üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", userCode);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥
    const isCorrect = userCode.trim() === correctCode.trim();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    showPracticeResult(practiceSection, isCorrect);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    savePracticeResult(lessonNum, isCorrect);
    
    console.log(`üîß –ü–†–Ø–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏: ${isCorrect ? '–≤–µ—Ä–Ω–æ' : '–Ω–µ–≤–µ—Ä–Ω–æ'}`);
}

/**
 * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ—Å—Ç–∞
 */
function showTestResult(testSection, isCorrect) {
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const existingMessage = testSection.querySelector('.feedback-message');
    if (existingMessage) {
        existingMessage.remove();
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const message = document.createElement('div');
    message.className = `feedback-message ${isCorrect ? 'success' : 'error'}`;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    if (isCorrect) {
        message.textContent = getCurrentLanguage() === 'ru' ? 
            '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –í—Å–µ –æ—Ç–≤–µ—Ç—ã –≤–µ—Ä–Ω—ã.' : 
            '–î“±—Ä—ã—Å! –ë–∞—Ä–ª—ã“õ –∂–∞—É–∞–ø—Ç–∞—Ä –¥“±—Ä—ã—Å.';
    } else {
        message.textContent = getCurrentLanguage() === 'ru' ? 
            '–ï—Å—Ç—å –æ—à–∏–±–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç—ã –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.' : 
            '“ö–∞—Ç–µ–ª—ñ–∫—Ç–µ—Ä –±–∞—Ä. –ñ–∞—É–∞–ø—Ç–∞—Ä–¥—ã —Ç–µ–∫—Å–µ—Ä—ñ–ø, “õ–∞–π—Ç–∞–ª–∞–ø –∫”©—Ä—ñ“£—ñ–∑.';
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–µ–∫—Ü–∏—é
    const button = testSection.querySelector('button');
    if (button && button.parentNode) {
        button.parentNode.appendChild(message);
    } else {
        testSection.appendChild(message);
    }
}

/**
 * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏
 */
function showPracticeResult(practiceSection, isCorrect) {
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const existingMessage = practiceSection.querySelector('.feedback-message');
    if (existingMessage) {
        existingMessage.remove();
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const message = document.createElement('div');
    message.className = `feedback-message ${isCorrect ? 'success' : 'error'}`;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    if (isCorrect) {
        message.textContent = getCurrentLanguage() === 'ru' ? 
            '–ö–æ–¥ –≤–µ—Ä–Ω—ã–π! –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ.' : 
            '–ö–æ–¥ –¥“±—Ä—ã—Å! –¢–∞–ø—Å—ã—Ä–º–∞ –æ—Ä—ã–Ω–¥–∞–ª–¥—ã.';
    } else {
        message.textContent = getCurrentLanguage() === 'ru' ? 
            '–ö–æ–¥ –Ω–µ–≤–µ—Ä–Ω—ã–π. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.' : 
            '–ö–æ–¥ –¥“±—Ä—ã—Å –µ–º–µ—Å. –¢–µ–∫—Å–µ—Ä—ñ–ø, “õ–∞–π—Ç–∞–ª–∞–ø –∫”©—Ä—ñ“£—ñ–∑.';
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–µ–∫—Ü–∏—é
    const button = practiceSection.querySelector('button');
    if (button && button.parentNode) {
        button.parentNode.appendChild(message);
    } else {
        practiceSection.appendChild(message);
    }
}

/**
 * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è
 */
function showCompletionMessage(canComplete) {
    if (canComplete) return;
    
    // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞
    const completeButton = document.querySelector('.complete-btn');
    if (!completeButton) return;
    
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const existingMessage = completeButton.parentNode.querySelector('.feedback-message');
    if (existingMessage) {
        existingMessage.remove();
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const message = document.createElement('div');
    message.className = 'feedback-message error';
    message.textContent = getCurrentLanguage() === 'ru' ? 
        '–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è' : 
        '–°–∞–±–∞“õ—Ç—ã –∞—è“õ—Ç–∞—É “Ø—à—ñ–Ω –±–∞—Ä–ª—ã“õ —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä–¥—ã –¥“±—Ä—ã—Å –æ—Ä—ã–Ω–¥–∞—É –∫–µ—Ä–µ–∫';
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–Ω–æ–ø–∫–∏
    completeButton.parentNode.appendChild(message);
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∞
 */
function getCorrectTestAnswers(lessonNum) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
    
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º window.pythonLesson[–Ω–æ–º–µ—Ä].quizAnswers
    if (window[`pythonLesson${lessonNum}`] && window[`pythonLesson${lessonNum}`].quizAnswers) {
        return window[`pythonLesson${lessonNum}`].quizAnswers;
    }
    
    // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º window.quizAnswers
    if (window.quizAnswers) {
        return window.quizAnswers;
    }
    
    // 3. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –ø–µ—Ä–≤—ã—Ö —É—Ä–æ–∫–æ–≤
    const fallbackAnswers = {
        1: { q1: "b", q2: "b", q3: "a", q4: "b", q5: "b" },
        2: { q1: "c", q2: "a", q3: "b", q4: "c", q5: "b" }
    };
    
    if (fallbackAnswers[lessonNum]) {
        return fallbackAnswers[lessonNum];
    }
    
    // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–∑–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã
    return { q1: "b", q2: "b", q3: "a", q4: "b", q5: "b" };
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
 */
function getCorrectPracticeCode(lessonNum) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
    
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º window.practiceAnswers
    if (window.practiceAnswers) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–∏—Å–ª–æ–≤–æ–π –∫–ª—é—á
        if (window.practiceAnswers[lessonNum]) {
            return window.practiceAnswers[lessonNum];
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ–∫–æ–≤—ã–π –∫–ª—é—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, "1-—Å–∞–±–∞“õ")
        const lessonKey = `${lessonNum}-—Å–∞–±–∞“õ`;
        if (window.practiceAnswers[lessonKey]) {
            return window.practiceAnswers[lessonKey];
        }
    }
    
    // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º window.pythonLesson[–Ω–æ–º–µ—Ä].practiceCode
    if (window[`pythonLesson${lessonNum}`] && window[`pythonLesson${lessonNum}`].practiceCode) {
        return window[`pythonLesson${lessonNum}`].practiceCode;
    }
    
    // 3. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –ø–µ—Ä–≤—ã—Ö —É—Ä–æ–∫–æ–≤
    const fallbackCodes = {
        1: 'print("S”ôlem, ”ôlem!")',
        2: 'x = 10\ny = 20\nprint(x + y)',
        3: 'a = 5\nb = 3\nsum = a + b\nprint(sum)'
    };
    
    if (fallbackCodes[lessonNum]) {
        return fallbackCodes[lessonNum];
    }
    
    // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∫–æ–¥ –≤ –ø—Ä–∏–º–µ—Ä–µ
    const codeExample = document.querySelector('.practice code, .practice pre')?.textContent;
    if (codeExample) {
        return codeExample;
    }
    
    // –ï—Å–ª–∏ –≤—Å–µ —Å–ø–æ—Å–æ–±—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–∑–æ–≤—ã–π –∫–æ–¥
    return 'print("Hello World")';
}

/**
 * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ—Å—Ç–∞
 */
function saveTestResult(lessonNum, isCorrect) {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    const results = JSON.parse(localStorage.getItem('testResults') || '{}');
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞
    results[lessonNum] = isCorrect;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    localStorage.setItem('testResults', JSON.stringify(results));
}

/**
 * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏
 */
function savePracticeResult(lessonNum, isCorrect) {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    const results = JSON.parse(localStorage.getItem('practiceResults') || '{}');
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞
    results[lessonNum] = isCorrect;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    localStorage.setItem('practiceResults', JSON.stringify(results));
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤—ã–ø–æ–ª–Ω–µ–Ω –ª–∏ —Ç–µ—Å—Ç
 */
function isTestCompleted() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–µ—Å—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const testSection = document.querySelector('.test, .quiz');
    if (!testSection) {
        return true; // –ï—Å–ª–∏ —Ç–µ—Å—Ç–∞ –Ω–µ—Ç, —Å—á–∏—Ç–∞–µ–º –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞
    const lessonNum = getLessonNumber();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
    const results = JSON.parse(localStorage.getItem('testResults') || '{}');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞
    return results[lessonNum] === true;
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ª–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
 */
function isPracticeCompleted() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const practiceSection = document.querySelector('.practice, .practice-section');
    if (!practiceSection) {
        return true; // –ï—Å–ª–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–µ—Ç, —Å—á–∏—Ç–∞–µ–º –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞
    const lessonNum = getLessonNumber();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∞–∫—Ç–∏–∫–∏
    const results = JSON.parse(localStorage.getItem('practiceResults') || '{}');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞
    return results[lessonNum] === true;
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞
 */
function getLessonNumber() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL
    const urlParams = new URLSearchParams(window.location.search);
    const lessonParam = urlParams.get('lesson');
    
    if (lessonParam) {
        const match = lessonParam.match(/\d+/);
        if (match) {
            return parseInt(match[0]);
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–ø–∏—Å–∫–µ —É—Ä–æ–∫–æ–≤
    const activeLesson = document.querySelector('.lesson-item.active, .lesson-list li.active');
    if (activeLesson) {
        const lessonId = activeLesson.getAttribute('data-lesson-id');
        if (lessonId) {
            const match = lessonId.match(/\d+/);
            if (match) {
                return parseInt(match[0]);
            }
        }
    }
    
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 1
    return 1;
}

/**
 * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
 */
function getCurrentLanguage() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —è–∑—ã–∫ HTML
    const htmlLang = document.documentElement.lang;
    if (htmlLang === 'ru' || htmlLang === 'kk') {
        return htmlLang;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL
    const currentUrl = window.location.href.toLowerCase();
    if (currentUrl.includes('_rus')) {
        return 'ru';
    }
    
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–∞–∑–∞—Ö—Å–∫–∏–π
    return 'kk';
}

// –†–∞—Å—à–∏—Ä—è–µ–º –ø—Ä–æ—Ç–æ—Ç–∏–ø –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–∫—Å—Ç—É
if (!Element.prototype.querySelector.toString().includes(':contains')) {
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä :contains –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
    document.addEventListener('DOMContentLoaded', function() {
        jQuery.expr[':'].contains = function(a, i, m) {
            return jQuery(a).text().toLowerCase().indexOf(m[3].toLowerCase()) >= 0;
        };
    });
}
